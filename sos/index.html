<!doctype html>
<html lang="fr">

<head>
  <!-- ðŸ“± META MOBILE FIRST -->
  <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0" />

  <!-- ðŸŽ¯ PWA & MOBILE -->
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#dc2626" media="(prefers-color-scheme: light)" />
  <meta name="theme-color" content="#b91c1c" media="(prefers-color-scheme: dark)" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="SOS Expat" />
  <meta name="apple-touch-fullscreen" content="yes" />
  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-touch-icon-76x76.png" />
  <!-- Apple Splash Screens (Launch Images) -->
  <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3)" href="/splash/apple-splash-1290x2796.svg" />
  <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)" href="/splash/apple-splash-1179x2556.svg" />
  <link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3)" href="/splash/apple-splash-1284x2778.svg" />
  <link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)" href="/splash/apple-splash-1170x2532.svg" />
  <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" href="/splash/apple-splash-1125x2436.svg" />
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)" href="/splash/apple-splash-1242x2688.svg" />
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)" href="/splash/apple-splash-828x1792.svg" />
  <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" href="/splash/apple-splash-750x1334.svg" />
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)" href="/splash/apple-splash-1242x2208.svg" />
  <!-- iPad Splash Screens -->
  <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)" href="/splash/apple-splash-2048x2732.svg" />
  <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)" href="/splash/apple-splash-1668x2388.svg" />
  <link rel="apple-touch-startup-image" media="screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2)" href="/splash/apple-splash-1640x2360.svg" />
  <link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)" href="/splash/apple-splash-1536x2048.svg" />

  <!-- ðŸ¤– ANDROID -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="application-name" content="SOS Expat" />

  <!-- ðŸ” SEO -->
  <title>SOS Expat & Travelers - Aide d'urgence pour expatriÃ©s</title>
  <meta name="description"
    content="Assistance urgente 24/7 pour expatriÃ©s francophones. Avocats, traducteurs, urgences mÃ©dicales. Support immÃ©diat partout dans le monde. Application mobile disponible." />
  <meta name="keywords"
    content="expat, urgence, assistance, avocat, francophone, voyage, expatriÃ©, aide, 24/7, mobile" />
  <link rel="canonical" href="https://sos-expat.com" />

  <!-- ðŸ”’ GOOGLE CONSENT MODE V2 - Must be FIRST before any Google tags -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }

    // Set default consent state (denied until user consents) - GDPR/EEA compliance
    gtag('consent', 'default', {
      'ad_storage': 'denied',
      'ad_user_data': 'denied',
      'ad_personalization': 'denied',
      'analytics_storage': 'denied',
      'functionality_storage': 'denied',
      'personalization_storage': 'denied',
      'security_storage': 'granted',
      'wait_for_update': 500
    });

    // Enable URL passthrough for better attribution when cookies blocked
    gtag('set', 'url_passthrough', true);
    // Redact ad click identifiers when ad_storage is denied
    gtag('set', 'ads_data_redaction', true);

    // Restore consent from localStorage if already given
    (function() {
      try {
        var saved = localStorage.getItem('cookie_preferences');
        if (saved) {
          var prefs = JSON.parse(saved);
          gtag('consent', 'update', {
            'ad_storage': prefs.marketing ? 'granted' : 'denied',
            'ad_user_data': prefs.marketing ? 'granted' : 'denied',
            'ad_personalization': prefs.marketing ? 'granted' : 'denied',
            'analytics_storage': prefs.analytics ? 'granted' : 'denied',
            'functionality_storage': prefs.performance ? 'granted' : 'denied',
            'personalization_storage': prefs.performance ? 'granted' : 'denied'
          });
        }
      } catch(e) {}
    })();
  </script>

  <!-- ðŸš€ PERFORMANCE HINTS -->
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://firestore.googleapis.com" crossorigin />
  <link rel="preconnect" href="https://api.stripe.com" crossorigin />
  <link rel="preconnect" href="https://api.twilio.com" crossorigin />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin />
  <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
  <link rel="dns-prefetch" href="https://www.google-analytics.com" />

  <!-- âš¡ PRELOADS -->
  <link rel="preload" href="/fonts/inter-var.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="prefetch" href="/icons/icon-512x512.png" />

  <!-- ðŸŽ¨ ICONS & FAVICONS -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" media="(prefers-color-scheme: light)" />
  <link rel="icon" type="image/svg+xml" href="/favicon-dark.svg" media="(prefers-color-scheme: dark)" />
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png" />
  <link rel="shortcut icon" href="/favicon.ico" />

  <!-- ðŸŒ SOCIAL -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://sos-expat.com/" />
  <meta property="og:title" content="SOS Expat & Travelers - Aide d'urgence 24/7" />
  <meta property="og:description"
    content="Assistance urgente pour expatriÃ©s francophones. Avocats, traducteurs, urgences. Support immÃ©diat mobile partout dans le monde." />
  <meta property="og:image" content="https://sos-expat.com/og-image-1200x630.jpg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="SOS Expat - Application mobile d'assistance urgente" />
  <meta property="og:locale" content="fr_FR" />
  <meta property="og:site_name" content="SOS Expat & Travelers" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content="https://sos-expat.com/" />
  <meta name="twitter:title" content="SOS Expat & Travelers - Aide d'urgence mobile" />
  <meta name="twitter:description"
    content="App mobile d'assistance urgente pour expatriÃ©s. Avocats, traducteurs, urgences 24/7. TÃ©lÃ©chargez l'app maintenant." />
  <meta name="twitter:image" content="https://sos-expat.com/twitter-image.png" />
  <meta name="twitter:creator" content="@sos-expat" />
  <meta name="twitter:site" content="@sos-expat" />

  <!-- ðŸ” BOTS -->
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />

  <!-- ðŸŽ¨ CRITICAL CSS - TOUT EN CSS STATIQUE -->
  <style>
    * {
      box-sizing: border-box;
    }

    html {
      -webkit-text-size-adjust: 100%;
      -webkit-tap-highlight-color: transparent;
      font-family: "Inter var", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    #root {
      min-height: 100vh;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      font-size: 18px;
      color: #666;
    }

    .app-loading {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      z-index: 9999;
      transition: opacity 0.3s ease;
    }

    @supports (padding: max(0px)) {
      body {
        padding-left: max(12px, env(safe-area-inset-left));
        padding-right: max(12px, env(safe-area-inset-right));
      }
    }

    @media (max-width: 768px) {
      html {
        font-size: 16px;
      }

      body {
        padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      }
    }

    @media (prefers-color-scheme: dark) {
      .app-loading {
        background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* âœ… Police Inter */
    @font-face {
      font-family: "Inter var";
      src: url("/fonts/inter-var.woff2") format("woff2");
      font-weight: 100 900;
      font-display: swap;
      font-style: normal;
    }
  </style>
</head>

<body>
  <!-- ðŸŒ LOCALE REDIRECT - Must be FIRST before anything else -->
  <script>
    (function() {
      // Only redirect if we're on root path without locale
      if (window.location.pathname !== '/' && window.location.pathname !== '') return;

      // Country -> Locale mapping (timezone-based detection)
      var TZ_TO_LOCALE = {
        'Europe/Paris': 'fr-fr', 'Europe/Brussels': 'fr-be', 'Europe/Luxembourg': 'fr-lu',
        'Africa/Algiers': 'fr-dz', 'Africa/Casablanca': 'fr-ma', 'Africa/Tunis': 'fr-tn',
        'Africa/Dakar': 'fr-sn', 'Africa/Abidjan': 'fr-ci', 'Africa/Douala': 'fr-cm',
        'Europe/Madrid': 'es-es', 'America/Mexico_City': 'es-mx', 'America/Argentina/Buenos_Aires': 'es-ar',
        'America/Bogota': 'es-co', 'America/Santiago': 'es-cl', 'America/Lima': 'es-pe',
        'America/New_York': 'en-us', 'America/Los_Angeles': 'en-us', 'America/Chicago': 'en-us',
        'Europe/London': 'en-gb', 'Australia/Sydney': 'en-au', 'Pacific/Auckland': 'en-nz',
        'Europe/Berlin': 'de-de', 'Europe/Vienna': 'de-at', 'Europe/Zurich': 'fr-ch',
        'Europe/Moscow': 'ru-ru', 'Europe/Minsk': 'ru-by', 'Asia/Almaty': 'ru-kz',
        'America/Sao_Paulo': 'pt-br', 'Europe/Lisbon': 'pt-pt',
        'Asia/Shanghai': 'ch-cn', 'Asia/Hong_Kong': 'ch-hk', 'Asia/Taipei': 'ch-tw',
        'Asia/Kolkata': 'hi-in', 'Asia/Kathmandu': 'hi-np',
        'Asia/Riyadh': 'ar-sa', 'Asia/Dubai': 'ar-ae', 'Africa/Cairo': 'ar-eg'
      };

      // Browser lang -> Locale fallback
      var LANG_TO_LOCALE = {
        'fr': 'fr-fr', 'en': 'en-us', 'es': 'es-es', 'de': 'de-de',
        'ru': 'ru-ru', 'pt': 'pt-pt', 'zh': 'ch-cn', 'hi': 'hi-in', 'ar': 'ar-sa'
      };

      var locale = 'fr-fr'; // Default

      // 1. Check saved preference (user manually changed language)
      try {
        var saved = localStorage.getItem('sos_language');
        if (saved && LANG_TO_LOCALE[saved]) {
          locale = LANG_TO_LOCALE[saved];
          window.location.replace('/' + locale);
          return;
        }
      } catch(e) {}

      // 2. Browser language (best for expats/travelers - German in Thailand sees German)
      try {
        var browserLang = (navigator.language || navigator.userLanguage || '').substring(0, 2).toLowerCase();
        if (browserLang && LANG_TO_LOCALE[browserLang]) {
          locale = LANG_TO_LOCALE[browserLang];
          window.location.replace('/' + locale);
          return;
        }
      } catch(e) {}

      // 3. Timezone fallback (for users with neutral browser settings)
      try {
        var tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
        if (tz && TZ_TO_LOCALE[tz]) {
          locale = TZ_TO_LOCALE[tz];
        }
      } catch(e) {}

      // Redirect to locale
      window.location.replace('/' + locale);
    })();
  </script>

  <!-- ðŸ”’ GTM noscript fallback - for users without JavaScript -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX"
      height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript>

  <!-- ðŸ“± Loading -->
  <div id="app-loading" class="app-loading">
    <div>
      <div style="font-size: 32px; margin-bottom: 16px">ðŸ†˜</div>
      <div>Chargement...</div>
    </div>
  </div>

  <!-- ðŸŽ¯ App -->
  <div id="root"></div>

  <!-- App entry - DOIT ÃŠTRE LE SEUL SCRIPT type="module" -->
  <script type="module" src="/src/main.tsx"></script>

  <!-- ðŸ”¥ SCRIPT POUR SUPPRIMER LE LOADING -->
  <script>
    // Attendre que React soit montÃ©
    setTimeout(function () {
      const loading = document.getElementById('app-loading');
      if (loading) {
        loading.style.opacity = '0';
        setTimeout(function () {
          loading.remove();
        }, 300);
      }
    }, 1000);
  </script>

  <!-- âŒ No JS -->
  <noscript>
    <div style="padding:20px; text-align:center; font-family:sans-serif; background:#fee2e2; color:#991b1b;">
      Cette application nÃ©cessite JavaScript pour fonctionner. Activez-le dans votre navigateur.
    </div>
  </noscript>
</body>

</html>