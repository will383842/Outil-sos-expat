<!doctype html>
<html lang="en">

<head>
  <!-- üì± META MOBILE FIRST -->
  <meta charset="UTF-8" />

  <!-- ‚úÖ META DOMAIN VERIFICATION (Meta/Facebook) -->
  <meta name="facebook-domain-verification" content="cvjk5his0trhli268xbk3gjzvges6h" />

  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0" />

  <!-- üéØ PWA & MOBILE -->
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#dc2626" media="(prefers-color-scheme: light)" />
  <meta name="theme-color" content="#b91c1c" media="(prefers-color-scheme: dark)" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="SOS Expat" />
  <meta name="apple-touch-fullscreen" content="yes" />
  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-touch-icon-76x76.png" />
  <!-- Apple Splash Screens (Launch Images) -->
  <link rel="apple-touch-startup-image"
    media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3)"
    href="/splash/apple-splash-1290x2796.svg" />
  <link rel="apple-touch-startup-image"
    media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)"
    href="/splash/apple-splash-1179x2556.svg" />
  <link rel="apple-touch-startup-image"
    media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3)"
    href="/splash/apple-splash-1284x2778.svg" />
  <link rel="apple-touch-startup-image"
    media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)"
    href="/splash/apple-splash-1170x2532.svg" />
  <link rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)"
    href="/splash/apple-splash-1125x2436.svg" />
  <link rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)"
    href="/splash/apple-splash-1242x2688.svg" />
  <link rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)"
    href="/splash/apple-splash-828x1792.svg" />
  <link rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)"
    href="/splash/apple-splash-750x1334.svg" />
  <link rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)"
    href="/splash/apple-splash-1242x2208.svg" />
  <!-- iPad Splash Screens -->
  <link rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)"
    href="/splash/apple-splash-2048x2732.svg" />
  <link rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)"
    href="/splash/apple-splash-1668x2388.svg" />
  <link rel="apple-touch-startup-image"
    media="screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2)"
    href="/splash/apple-splash-1640x2360.svg" />
  <link rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)"
    href="/splash/apple-splash-1536x2048.svg" />

  <!-- ü§ñ ANDROID -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="application-name" content="SOS Expat" />

  <!-- üîç SEO -->
  <title>SOS Expat & Travelers - 24/7 Emergency Help Worldwide</title>
  <meta name="description"
    content="Talk to a lawyer or local expert in your language in under 5 min. 197 countries, all languages. 24/7 assistance for expats, travelers and vacationers." />
  <meta name="keywords"
    content="expat, emergency, assistance, lawyer, international, travel, expatriate, help, 24/7, all languages, 197 countries, partner lawyer" />
  <link rel="canonical" href="https://sos-expat.com" />

  <!-- üîí GOOGLE CONSENT MODE V2 - Must be FIRST before any Google tags -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }

    // Set default consent state (denied until user consents) - GDPR/EEA compliance
    gtag('consent', 'default', {
      'ad_storage': 'denied',
      'ad_user_data': 'denied',
      'ad_personalization': 'denied',
      'analytics_storage': 'denied',
      'functionality_storage': 'denied',
      'personalization_storage': 'denied',
      'security_storage': 'granted',
      'wait_for_update': 500
    });

    // Enable URL passthrough for better attribution when cookies blocked
    gtag('set', 'url_passthrough', true);
    // Redact ad click identifiers when ad_storage is denied
    gtag('set', 'ads_data_redaction', true);

    // Restore consent from localStorage if already given
    (function () {
      try {
        var saved = localStorage.getItem('cookie_preferences');
        if (saved) {
          var prefs = JSON.parse(saved);
          gtag('consent', 'update', {
            'ad_storage': prefs.marketing ? 'granted' : 'denied',
            'ad_user_data': prefs.marketing ? 'granted' : 'denied',
            'ad_personalization': prefs.marketing ? 'granted' : 'denied',
            'analytics_storage': prefs.analytics ? 'granted' : 'denied',
            'functionality_storage': prefs.performance ? 'granted' : 'denied',
            'personalization_storage': prefs.performance ? 'granted' : 'denied'
          });
        }
      } catch (e) { }
    })();
  </script>

  <!-- ‚úÖ‚úÖ‚úÖ META PIXEL (Facebook) ‚Äî SANS GDPR (TRACK DIRECT) -->
  <script>
    (function () {
      var PIXEL_ID = '1887073748568784';

      !function (f, b, e, v, n, t, s) {
        if (f.fbq) return;
        n = f.fbq = function () {
          n.callMethod ? n.callMethod.apply(n, arguments) : n.queue.push(arguments)
        };
        if (!f._fbq) f._fbq = n;
        n.push = n;
        n.loaded = !0;
        n.version = '2.0';
        n.queue = [];
        t = b.createElement(e);
        t.async = !0;
        t.src = v;
        s = b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t, s)
      }(window, document, 'script', 'https://connect.facebook.net/en_US/fbevents.js');

      fbq('init', PIXEL_ID);

      // ‚úÖ Track imm√©diatement (aucun consentement / GDPR)
      fbq('track', 'PageView');

      // Flag √©ventuel si tu veux conditionner des events c√¥t√© app
      window.__metaMarketingGranted = true;

      // On garde la fonction pour ne rien casser si ta banni√®re l'appelle
      window.metaPixelConsent = function () { };
    })();
  </script>
  <!-- ‚úÖ‚úÖ‚úÖ FIN META PIXEL (noscript moved to body) -->

  <!-- üöÄ PERFORMANCE HINTS -->
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://firestore.googleapis.com" crossorigin />
  <link rel="preconnect" href="https://api.stripe.com" crossorigin />
  <link rel="preconnect" href="https://api.twilio.com" crossorigin />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin />
  <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
  <link rel="dns-prefetch" href="https://www.google-analytics.com" />

  <!-- ‚ö° PRELOADS -->
  <link rel="preload" href="/fonts/inter-var.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="prefetch" href="/icons/icon-512x512.png" />

  <!-- üé® ICONS & FAVICONS -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" media="(prefers-color-scheme: light)" />
  <link rel="icon" type="image/svg+xml" href="/favicon-dark.svg" media="(prefers-color-scheme: dark)" />
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png" />
  <link rel="shortcut icon" href="/favicon.ico" />

  <!-- üåê SOCIAL -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://sos-expat.com/" />
  <meta property="og:title" content="SOS Expat & Travelers - 24/7 Emergency Help Worldwide" />
  <meta property="og:description"
    content="Talk to a lawyer or local expert in your language in under 5 min. 197 countries, all languages. For expats, travelers, vacationers." />
  <meta property="og:image" content="https://sos-expat.com/og-image-1200x630.jpg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="SOS Expat - Emergency assistance mobile app" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:site_name" content="SOS Expat & Travelers" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content="https://sos-expat.com/" />
  <meta name="twitter:title" content="SOS Expat & Travelers - 24/7 Mobile Emergency Help" />
  <meta name="twitter:description"
    content="Emergency assistance mobile app for expats. Lawyers, translators, 24/7 emergencies. Download the app now." />
  <meta name="twitter:image" content="https://sos-expat.com/twitter-image.png" />
  <meta name="twitter:creator" content="@sos-expat" />
  <meta name="twitter:site" content="@sos-expat" />

  <!-- üîç BOTS -->
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:-1, max-video-preview:-1" />

  <!-- üé® CRITICAL CSS - TOUT EN CSS STATIQUE -->
  <style>
    * {
      box-sizing: border-box;
    }

    html {
      -webkit-text-size-adjust: 100%;
      -webkit-tap-highlight-color: transparent;
      font-family: "Inter var", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    #root {
      min-height: 100vh;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      font-size: 18px;
      color: #666;
    }

    .app-loading {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      z-index: 9999;
      transition: opacity 0.3s ease;
    }

    @supports (padding: max(0px)) {
      body {
        padding-left: max(12px, env(safe-area-inset-left));
        padding-right: max(12px, env(safe-area-inset-right));
      }
    }

    @media (max-width: 768px) {
      html {
        font-size: 16px;
      }

      body {
        padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      }
    }

    @media (prefers-color-scheme: dark) {
      .app-loading {
        background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* ‚úÖ Police Inter - Optimis√©e pour √©viter CLS */
    @font-face {
      font-family: "Inter var";
      src: url("/fonts/inter-var.woff2") format("woff2");
      font-weight: 100 900;
      font-display: swap;
      font-style: normal;
      /* Ajustements m√©triques pour √©viter le layout shift */
      size-adjust: 100%;
      ascent-override: 90%;
      descent-override: 22%;
      line-gap-override: 0%;
    }
  </style>
</head>

<body>
  <!-- Meta Pixel noscript fallback -->
  <noscript>
    <img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=1887073748568784&ev=PageView&noscript=1" />
  </noscript>

  <!-- üåç LOCALE REDIRECT - Must be FIRST before anything else -->
  <script>
    (function () {
      // Only redirect if we're on root path without locale
      if (window.location.pathname !== '/' && window.location.pathname !== '') return;

      // Timezone -> Country code mapping
      var TZ_TO_COUNTRY = {
        // Europe
        'Europe/Paris': 'fr', 'Europe/Brussels': 'be', 'Europe/Luxembourg': 'lu',
        'Europe/Madrid': 'es', 'Europe/London': 'gb', 'Europe/Berlin': 'de',
        'Europe/Vienna': 'at', 'Europe/Zurich': 'ch', 'Europe/Rome': 'it',
        'Europe/Amsterdam': 'nl', 'Europe/Lisbon': 'pt', 'Europe/Warsaw': 'pl',
        'Europe/Prague': 'cz', 'Europe/Stockholm': 'se', 'Europe/Oslo': 'no',
        'Europe/Copenhagen': 'dk', 'Europe/Helsinki': 'fi', 'Europe/Dublin': 'ie',
        'Europe/Athens': 'gr', 'Europe/Bucharest': 'ro', 'Europe/Budapest': 'hu',
        'Europe/Moscow': 'ru', 'Europe/Minsk': 'by', 'Europe/Kiev': 'ua',
        // Americas
        'America/New_York': 'us', 'America/Los_Angeles': 'us', 'America/Chicago': 'us',
        'America/Denver': 'us', 'America/Phoenix': 'us', 'America/Toronto': 'ca',
        'America/Vancouver': 'ca', 'America/Mexico_City': 'mx', 'America/Sao_Paulo': 'br',
        'America/Argentina/Buenos_Aires': 'ar', 'America/Bogota': 'co', 'America/Santiago': 'cl',
        'America/Lima': 'pe', 'America/Caracas': 've',
        // Asia
        'Asia/Tokyo': 'jp', 'Asia/Shanghai': 'cn', 'Asia/Hong_Kong': 'hk',
        'Asia/Singapore': 'sg', 'Asia/Seoul': 'kr', 'Asia/Taipei': 'tw',
        'Asia/Bangkok': 'th', 'Asia/Jakarta': 'id', 'Asia/Manila': 'ph',
        'Asia/Kuala_Lumpur': 'my', 'Asia/Ho_Chi_Minh': 'vn', 'Asia/Kolkata': 'in',
        'Asia/Dubai': 'ae', 'Asia/Riyadh': 'sa', 'Asia/Tel_Aviv': 'il',
        'Asia/Beirut': 'lb', 'Asia/Almaty': 'kz',
        // Africa
        'Africa/Cairo': 'eg', 'Africa/Johannesburg': 'za', 'Africa/Lagos': 'ng',
        'Africa/Nairobi': 'ke', 'Africa/Casablanca': 'ma', 'Africa/Algiers': 'dz',
        'Africa/Tunis': 'tn', 'Africa/Dakar': 'sn', 'Africa/Abidjan': 'ci',
        // Oceania
        'Australia/Sydney': 'au', 'Australia/Melbourne': 'au', 'Australia/Perth': 'au',
        'Pacific/Auckland': 'nz'
      };

      // Supported languages
      var SUPPORTED_LANGS = ['fr', 'en', 'es', 'de', 'ru', 'pt', 'zh', 'hi', 'ar'];

      // Map browser lang codes to our lang codes
      var LANG_MAP = { 'zh': 'ch' }; // Chinese uses 'ch' in our system

      var lang = 'fr'; // Default language
      var country = 'fr'; // Default country

      // 1. Check saved preference (user manually changed language)
      try {
        var saved = localStorage.getItem('sos_language');
        if (saved && SUPPORTED_LANGS.includes(saved)) {
          lang = saved;
        }
      } catch (e) { }

      // 2. Detect language from browser (if no saved preference)
      if (!localStorage.getItem('sos_language')) {
        try {
          var browserLang = (navigator.language || navigator.userLanguage || '').substring(0, 2).toLowerCase();
          if (browserLang && SUPPORTED_LANGS.includes(browserLang)) {
            lang = browserLang;
          } else if (browserLang && LANG_MAP[browserLang]) {
            lang = LANG_MAP[browserLang];
          }
        } catch (e) { }
      }

      // 3. Detect country from timezone
      try {
        var tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
        if (tz && TZ_TO_COUNTRY[tz]) {
          country = TZ_TO_COUNTRY[tz];
        }
      } catch (e) { }

      // Build locale: language-country (e.g., de-th, en-cn, fr-jp)
      var locale = lang + '-' + country;

      // Redirect to locale
      window.location.replace('/' + locale);
    })();
  </script>

  <!-- üîí GTM noscript fallback - for users without JavaScript -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX" height="0" width="0"
      style="display:none;visibility:hidden"></iframe>
  </noscript>

  <!-- üì± Loading -->
  <div id="app-loading" class="app-loading">
    <div>
      <div style="font-size: 32px; margin-bottom: 16px">üÜò</div>
      <div>Loading...</div>
    </div>
  </div>

  <!-- üéØ App -->
  <div id="root"></div>

  <!-- App entry - DOIT √äTRE LE SEUL SCRIPT type="module" -->
  <script type="module" src="/src/main.tsx"></script>

  <!-- üîß MODULE LOAD ERROR RECOVERY - Handles stale cache issues -->
  <script>
    // Detects when JS modules fail to load (MIME type error from stale cache)
    // Forces a hard reload to get fresh assets
    (function () {
      var reloadAttempted = sessionStorage.getItem('_reload_attempted');

      window.addEventListener('error', function (e) {
        // Check if it's a module loading error
        if (e.message && (
          e.message.includes('Failed to fetch dynamically imported module') ||
          e.message.includes('Failed to load module script') ||
          e.message.includes('Loading module') ||
          e.message.includes('ChunkLoadError')
        )) {
          // Only try once per session to avoid infinite reload loops
          if (!reloadAttempted) {
            sessionStorage.setItem('_reload_attempted', '1');
            console.log('[Recovery] Module load error detected, reloading...');
            // Clear service worker cache and reload
            if ('caches' in window) {
              caches.keys().then(function (names) {
                names.forEach(function (name) { caches.delete(name); });
              }).finally(function () {
                window.location.reload(true);
              });
            } else {
              window.location.reload(true);
            }
          }
        }
      }, true);

      // Clear the flag after successful load
      window.addEventListener('load', function () {
        setTimeout(function () {
          sessionStorage.removeItem('_reload_attempted');
        }, 5000);
      });
    })();
  </script>

  <!-- üî• SCRIPT POUR SUPPRIMER LE LOADING - Optimis√© -->
  <script>
    // Supprime le loading quand React est mont√© OU apr√®s timeout de s√©curit√©
    (function () {
      var loading = document.getElementById('app-loading');
      var removed = false;

      function removeLoading() {
        if (removed || !loading) return;
        removed = true;
        loading.style.opacity = '0';
        setTimeout(function () {
          if (loading && loading.parentNode) loading.remove();
        }, 300);
      }

      // √âcouter l'√©v√©nement personnalis√© de React (si √©mis par App)
      window.addEventListener('app-mounted', removeLoading);

      // Observer le DOM pour d√©tecter quand #root a du contenu
      if (window.MutationObserver) {
        var root = document.getElementById('root');
        if (root) {
          var observer = new MutationObserver(function (mutations) {
            if (root.children.length > 0) {
              observer.disconnect();
              removeLoading();
            }
          });
          observer.observe(root, { childList: true });
        }
      }

      // Fallback: timeout de s√©curit√© (3s max)
      setTimeout(removeLoading, 3000);
    })();
  </script>

  <!-- ‚ùå No JS -->
  <noscript>
    <div style="padding:20px; text-align:center; font-family:sans-serif; background:#fee2e2; color:#991b1b;">
      This application requires JavaScript to run. Please enable it in your browser.
    </div>
  </noscript>
</body>

</html>
